<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة متابعة الحمل المتكاملة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f8f0ff 0%, #e6f3ff 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0d0ff;
        }
        
        h1 {
            color: #6a0dad;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7d7d7d;
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        /* Tabs navigation - تحسين التبويبات */
        .tabs-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 50px;
            padding: 3px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border: 1px solid #e6d6ff;
            width: 100%;
            max-width: 600px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            border: none;
            background: none;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 50px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6a0dad;
            background: #f0e6ff;
            flex: 1;
            justify-content: center;
            text-align: center;
        }
        
        .tab-btn.active {
            background: linear-gradient(to right, #8a2be2, #6a0dad);
            color: white;
            box-shadow: 0 3px 8px rgba(138, 43, 226, 0.3);
        }
        
        /* Tab content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .app-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #eae0ff;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #eae0ff;
        }
        
        .calendar-section {
            flex: 100%;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-top: 10px;
            border: 1px solid #eae0ff;
        }
        
        .section-title {
            color: #6a0dad;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.4rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
        }
        
        .date-input-container {
            position: relative;
            width: 100%;
        }
        
        .date-input-container i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #8a2be2;
            font-size: 1.2rem;
            pointer-events: none;
        }
        
        input[type="date"], input[type="number"], select {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
            cursor: pointer;
            background: #f9f5ff;
        }
        
        /* تحسين مظهر الأيام غير القابلة للتحديد */
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 1;
        }
        
        input[type="date"]::-webkit-datetime-edit-fields-wrapper {
            color: #333;
        }
        
        input[type="date"]::-webkit-datetime-edit-text {
            color: #999;
        }
        
        input[type="date"]::-webkit-inner-spin-button {
            display: none;
        }
        
        input[type="date"]::-webkit-clear-button {
            display: none;
        }
        
        input:focus, select:focus {
            border-color: #8a2be2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2);
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            background: #f9f5ff;
            border: 1px solid #e6d6ff;
            transition: all 0.2s;
        }
        
        .radio-item:hover {
            background: #f0e6ff;
            border-color: #d0b0ff;
        }
        
        .radio-item input[type="radio"] {
            accent-color: #6a0dad;
        }
        
        button {
            background: linear-gradient(to right, #8a2be2, #6a0dad);
            color: white;
            border: none;
            padding: 14px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
        }
        
        .result-box {
            background: #f9f4ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #8a2be2;
            transition: transform 0.3s;
        }
        
        .result-box:hover {
            transform: translateX(5px);
        }
        
        .result-title {
            font-weight: 700;
            color: #6a0dad;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin: 10px 0;
            padding: 8px 0;
            border-top: 1px dashed #d0b0ff;
            border-bottom: 1px dashed #d0b0ff;
        }
        
        .progress-container {
            margin: 25px 0;
            background: #f5f0ff;
            padding: 15px;
            border-radius: 10px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-weight: 600;
            color: #6a0dad;
        }
        
        .progress-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #8a2be2, #6a0dad);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease-in-out;
        }
        
        .week-details {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(to right, #f0e6ff, #e6d6ff);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            box-shadow: 0 3px 10px rgba(106, 13, 173, 0.1);
        }
        
        .week-info {
            text-align: center;
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .week-number {
            font-size: 2rem;
            font-weight: 700;
            color: #8a2be2;
            margin-top: 5px;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .calendar-header {
            background: #6a0dad;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            border-radius: 8px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .calendar-day {
            background: #f8f0ff;
            padding: 10px;
            text-align: center;
            border-radius: 8px;
            min-height: 150px;
            position: relative;
            transition: transform 0.2s, background-color 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 1px solid #e6d6ff;
        }
        
        .calendar-day:hover {
            transform: translateY(-5px);
            background: #e6d6ff;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.2);
        }
        
        .day-number-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .day-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: #6a0dad;
            background: rgba(255, 255, 255, 0.7);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .day-info-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
            text-align: center;
            margin-top: 5px;
        }

        .week-label {
            font-size: 0.85rem;
            font-weight: bold;
            color: #6a0dad;
            background: rgba(138, 43, 226, 0.1);
            padding: 4px 8px;
            border-radius: 15px;
        }

        .pregnancy-month-label {
            font-size: 0.9rem;
            font-weight: bold;
            color: #8a2be2;
            background: rgba(138, 43, 226, 0.15);
            padding: 4px 8px;
            border-radius: 8px;
            margin-top: 5px;
        }

        .month-year {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 500;
            margin-top: 5px;
            background: rgba(255, 255, 255, 0.7);
            padding: 3px 6px;
            border-radius: 5px;
        }
        
        .year-display {
            font-size: 0.85rem;
            color: #8a2be2;
            font-weight: bold;
            margin-top: 2px;
            background: rgba(255, 255, 255, 0.7);
            padding: 2px 6px;
            border-radius: 5px;
        }

        .today { 
            background: #d4edda; 
            border: 2px solid #28a745;
            box-shadow: 0 0 0 2px #28a745;
        }
        .pregnancy-start { 
            background: #d1ecf1; 
            border: 2px solid #17a2b8;
            box-shadow: 0 0 0 2px #17a2b8;
        }
        .due-date { 
            background: #f8d7da; 
            border: 2px solid #dc3545;
            box-shadow: 0 0 0 2px #dc3545;
        }
        .current-week { 
            background: #fff3cd; 
            border: 2px solid #ffc107;
        }
        
        .legend { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            margin-top: 25px; 
            justify-content: center;
            background: #f9f5ff;
            padding: 15px;
            border-radius: 10px;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            padding: 5px 10px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .legend-color { 
            width: 20px; 
            height: 20px; 
            border-radius: 4px; 
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #6c757d;
            font-size: 0.9rem;
            padding: 20px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            border: 1px solid #eae0ff;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            text-align: center;
            width: 90%;
            max-width: 400px;
            transform: translateY(-50px);
            transition: transform 0.3s;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #dc3545;
            margin-bottom: 15px;
        }
        .modal-body {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        .modal-close-btn {
            background: #6a0dad;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .modal-close-btn:hover {
            background: #8a2be2;
        }
        
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .calendar { grid-template-columns: repeat(4, 1fr); }
            .week-details { flex-direction: column; gap: 10px; }
            .week-info { width: 100%; }
            .tabs { flex-direction: column; width: 100%; }
            .tab-btn { width: 100%; border-radius: 8px; margin-bottom: 5px; }
        }
        
        @media (max-width: 480px) {
            .calendar { grid-template-columns: repeat(2, 1fr); }
            h1 { font-size: 2rem; }
            .calendar-day { min-height: 150px; }
            .result-value { font-size: 1.3rem; }
            .tabs { flex-direction: column; }
            .tab-btn { margin-bottom: 5px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-baby"></i> أداة متابعة الحمل المتكاملة</h1>
            <p class="subtitle">أداة احترافية لحساب موعد الحمل والولادة وتتبع مراحل الحمل مع خاصية الحسابات العكسية</p>
        </header>
        
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="direct-tab">
                    <i class="fas fa-calculator"></i> الحساب المباشر
                </button>
                <button class="tab-btn" data-tab="reverse-tab">
                    <i class="fas fa-exchange-alt"></i> الحسابات العكسية
                </button>
            </div>
        </div>
        
        <!-- Direct Calculation Tab -->
        <div id="direct-tab" class="tab-content active">
            <div class="app-container">
                <div class="input-section">
                    <h2 class="section-title"><i class="fas fa-calculator"></i> بيانات الحساب المباشر</h2>
                    
                    <div class="form-group">
                        <label for="method">طريقة الحساب:</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" id="lmp" name="method" value="lmp" checked>
                                <label for="lmp">تاريخ آخر دورة شهرية</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="ivf" name="method" value="ivf">
                                <label for="ivf">موعد الحقن المجهري</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" id="edd" name="method" value="edd">
                                <label for="edd">أعرف تاريخ الولادة المتوقع</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="date">تاريخ البداية:</label>
                        <div class="date-input-container">
                            <i class="fas fa-calendar-alt"></i>
                            <input type="date" id="date">
                        </div>
                    </div>
                    
                    <button id="calculate-btn">
                        <i class="fas fa-calculator"></i> احسب موعد الحمل والولادة
                    </button>
                </div>
                
                <div class="result-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> نتائج الحساب المباشر</h2>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-calendar-alt"></i> تاريخ بداية الحمل</div>
                        <div class="result-value" id="pregnancy-start-date">--/--/----</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-flag-checkered"></i> موعد الولادة المتوقع</div>
                        <div class="result-value" id="due-date">--/--/----</div>
                        <p>بناءً على تاريخ البداية المحدد ومدة الحمل البالغة 40 أسبوعاً</p>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-baby"></i> الأسبوع الحالي من الحمل</div>
                        <div class="result-value" id="current-week">--</div>
                        <p>حساب الأسبوع الحالي بناءً على تاريخ اليوم</p>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>بداية الحمل</span>
                            <span>موعد الولادة</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="pregnancy-progress"></div>
                        </div>
                    </div>
                    
                    <div class="week-details">
                        <div class="week-info">
                            <div>الأسبوع الأول</div>
                            <div class="week-number" id="start-week">1</div>
                        </div>
                        <div class="week-info">
                            <div>الأسبوع الحالي</div>
                            <div class="week-number" id="display-current-week">--</div>
                        </div>
                        <div class="week-info">
                            <div>الأسبوع الأخير</div>
                            <div class="week-number" id="end-week">40</div>
                        </div>
                    </div>
                </div>
                
                <div class="calendar-section">
                    <h2 class="section-title"><i class="fas fa-calendar-alt"></i> تقويم متابعة الحمل</h2>
                    <div class="calendar" id="pregnancy-calendar"></div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background-color: #d4edda;"></div><span>اليوم الحالي</span></div>
                        <div class="legend-item"><div class="legend-color" style="background-color: #d1ecf1;"></div><span>بداية الحمل</span></div>
                        <div class="legend-item"><div class="legend-color" style="background-color: #f8d7da;"></div><span>موعد الولادة</span></div>
                        <div class="legend-item"><div class="legend-color" style="background-color: #fff3cd;"></div><span>الأسبوع الحالي</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reverse Calculation Tab -->
        <div id="reverse-tab" class="tab-content">
            <div class="app-container">
                <div class="input-section">
                    <h2 class="section-title"><i class="fas fa-exchange-alt"></i> بيانات الحساب العكسي</h2>
                    
                    <div class="form-group">
                        <label for="target-date">التاريخ المطلوب:</label>
                        <div class="date-input-container">
                            <i class="fas fa-calendar-alt"></i>
                            <input type="date" id="target-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pregnancy-month">الشهر من الحمل:</label>
                        <select id="pregnancy-month">
                            <option value="1">الشهر الأول (1)</option>
                            <option value="2">الشهر الثاني (2)</option>
                            <option value="3">الشهر الثالث (3)</option>
                            <option value="4">الشهر الرابع (4)</option>
                            <option value="5">الشهر الخامس (5)</option>
                            <option value="6">الشهر السادس (6)</option>
                            <option value="7">الشهر السابع (7)</option>
                            <option value="8">الشهر الثامن (8)</option>
                            <option value="9">الشهر التاسع (9)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pregnancy-week">الأسبوع من الحمل:</label>
                        <input type="number" id="pregnancy-week" min="1" max="40" value="20">
                    </div>
                    
                    <div class="form-group">
                        <label for="week-day">يوم من الأسبوع:</label>
                        <select id="week-day">
                            <option value="1">يوم 1</option>
                            <option value="2">يوم 2</option>
                            <option value="3">يوم 3</option>
                            <option value="4">يوم 4</option>
                            <option value="5">يوم 5</option>
                            <option value="6">يوم 6</option>
                            <option value="7">يوم 7</option>
                        </select>
                    </div>
                    
                    <button id="reverse-calculate-btn">
                        <i class="fas fa-calculator"></i> احسب بداية الحمل والولادة
                    </button>
                </div>
                
                <div class="result-section">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> نتائج الحساب العكسي</h2>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-calendar-alt"></i> تاريخ بداية الحمل</div>
                        <div class="result-value" id="reverse-pregnancy-start-date">--/--/----</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-flag-checkered"></i> موعد الولادة المتوقع</div>
                        <div class="result-value" id="reverse-due-date">--/--/----</div>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-calendar-check"></i> التاريخ المطلوب</div>
                        <div class="result-value" id="reverse-target-date">--/--/----</div>
                        <p>بناءً على المدخلات التي قمت بإدخالها</p>
                    </div>
                    
                    <div class="result-box">
                        <div class="result-title"><i class="fas fa-info-circle"></i> معلومات الحمل</div>
                        <p id="reverse-info">ستكونين في الأسبوع -- من الحمل، يوم -- من الأسبوع</p>
                        <p id="reverse-month-info">في الشهر -- من الحمل</p>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>بداية الحمل</span>
                            <span>موعد الولادة</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="reverse-pregnancy-progress"></div>
                        </div>
                    </div>
                </div>
                
                <div class="calendar-section">
                    <h2 class="section-title"><i class="fas fa-calendar-alt"></i> تقويم متابعة الحمل العكسي</h2>
                    <div class="calendar" id="reverse-pregnancy-calendar"></div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background-color: #d1ecf1;"></div><span>بداية الحمل</span></div>
                        <div class="legend-item"><div class="legend-color" style="background-color: #f8d7da;"></div><span>موعد الولادة</span></div>
                        <div class="legend-item"><div class="legend-color" style="background-color: #fff3cd;"></div><span>التاريخ المطلوب</span></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>أداة متابعة الحمل للفريق - تم تصميم هذه الأداة خصيصًا لفريق اختبار البرمجيات لتتبع مراحل الحمل</p>
            <p>يمكن إضافة خصائص جديدة حسب احتياجات الفريق في المستقبل</p>
        </div>
    </div>

    <!-- Modal for error messages -->
    <div class="modal-overlay" id="error-modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">خطأ في الإدخال</div>
            <div class="modal-body" id="modal-message">رسالة الخطأ هنا.</div>
            <button class="modal-close-btn" id="modal-close">حسنًا</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching functionality
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Constants
            const PREGNANCY_WEEKS = 40;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Set today as default for date inputs
            document.getElementById('date').valueAsDate = today;
            document.getElementById('target-date').valueAsDate = today;
            
            // Initialize direct calculation
            initDirectCalculation();
            
            // Initialize reverse calculation
            initReverseCalculation();
            
            // Initialize calendar functionality
            initCalendar();
            
            function initDirectCalculation() {
                // Direct calculation functionality
                const calculateBtn = document.getElementById('calculate-btn');
                const dateInput = document.getElementById('date');
                const pregnancyStartDateElement = document.getElementById('pregnancy-start-date');
                const dueDateElement = document.getElementById('due-date');
                const currentWeekElement = document.getElementById('current-week');
                const displayCurrentWeekElement = document.getElementById('display-current-week');
                const pregnancyProgress = document.getElementById('pregnancy-progress');
                const calendarElement = document.getElementById('pregnancy-calendar');
                const methodRadios = document.querySelectorAll('input[name="method"]');
                const dateLabel = document.querySelector('label[for="date"]');
                
                // Modal elements
                const errorModal = document.getElementById('error-modal');
                const modalTitle = document.getElementById('modal-title');
                const modalMessage = document.getElementById('modal-message');
                const modalCloseBtn = document.getElementById('modal-close');
                
                // Update date input label based on selected method
                methodRadios.forEach(radio => {
                    radio.addEventListener('change', function() {
                        if (this.value === 'edd') {
                            dateLabel.textContent = "تاريخ الولادة المتوقع:";
                            dateInput.removeAttribute('max');
                        } else if (this.value === 'ivf'){
                            dateLabel.textContent = "تاريخ الحقن المجهرى:";
                            dateInput.max = today.toISOString().split("T")[0];
                        } else {
                            dateLabel.textContent = "تاريخ البداية:";
                            dateInput.max = today.toISOString().split("T")[0];
                        }
                    });
                });

                // Event Listeners
                calculateBtn.addEventListener('click', calculatePregnancy);
                modalCloseBtn.addEventListener('click', () => errorModal.classList.remove('show'));
                errorModal.addEventListener('click', (e) => {
                    if (e.target === errorModal) {
                        errorModal.classList.remove('show');
                    }
                });

                // Function to show the custom modal
                function showModal(title, message) {
                    modalTitle.textContent = title;
                    modalMessage.textContent = message;
                    errorModal.classList.add('show');
                }
                
                function calculatePregnancy() {
                    const method = document.querySelector('input[name="method"]:checked').value;
                    const selectedDate = new Date(dateInput.value);
                    
                    if (isNaN(selectedDate.getTime())) {
                        showModal('خطأ في الإدخال', 'الرجاء اختيار تاريخ صحيح من التقويم.');
                        return;
                    }
                    selectedDate.setHours(0, 0, 0, 0);
                    
                    // Validation Checks
                    if ((method === 'lmp' || method === 'ivf') && selectedDate > today) {
                        showModal('تاريخ غير صحيح', 'لا يمكن اختيار تاريخ في المستقبل. الرجاء اختيار تاريخ اليوم أو تاريخ سابق.');
                        return;
                    }
                    
                    let pregnancyStartDate, dueDate;
                    
                    if (method === 'lmp') {
                        pregnancyStartDate = new Date(selectedDate);
                        dueDate = new Date(pregnancyStartDate);
                        dueDate.setDate(dueDate.getDate() + PREGNANCY_WEEKS * 7);
                    } 
                    else if (method === 'ivf') {
                        pregnancyStartDate = new Date(selectedDate);
                        pregnancyStartDate.setDate(pregnancyStartDate.getDate() - 14);
                        dueDate = new Date(pregnancyStartDate);
                        dueDate.setDate(dueDate.getDate() + PREGNANCY_WEEKS * 7);
                    } 
                    else { // EDD method
                        dueDate = new Date(selectedDate);
                        pregnancyStartDate = new Date(dueDate);
                        pregnancyStartDate.setDate(pregnancyStartDate.getDate() - PREGNANCY_WEEKS * 7);
                    }
                    
                    // Check if pregnancy has ended
                    if (dueDate < today) {
                        const timeDiff = today - dueDate;
                        const daysSinceEnded = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                        
                        let dayString;
                        if (daysSinceEnded <= 0) {
                            dayString = "اليوم";
                        } else if (daysSinceEnded === 1) {
                            dayString = "يوم واحد";
                        } else if (daysSinceEnded === 2) {
                            dayString = "يومين";
                        } else if (daysSinceEnded >= 3 && daysSinceEnded <= 10) {
                            dayString = `${daysSinceEnded} أيام`;
                        } else {
                            dayString = `${daysSinceEnded} يومًا`;
                        }

                        const message = `بناءً على التاريخ المحدد، يبدو أن الحمل قد انتهى بالفعل منذ ${dayString}. الرجاء التأكد من التاريخ.`;
                        showModal('تاريخ غير منطقي', message);
                        return;
                    }
                    
                    // Calculate current week
                    const diffTime = today - pregnancyStartDate;
                    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
                    const currentWeek = Math.min(Math.floor(diffDays / 7) + 1, PREGNANCY_WEEKS);
                    
                    // Update UI
                    pregnancyStartDateElement.textContent = formatDate(pregnancyStartDate);
                    dueDateElement.textContent = formatDate(dueDate);
                    currentWeekElement.textContent = `الأسبوع ${currentWeek > 0 ? currentWeek : 'قبل الحمل'}`;
                    displayCurrentWeekElement.textContent = currentWeek > 0 ? currentWeek : '-';
                    
                    const progressPercent = Math.min((diffDays / (PREGNANCY_WEEKS * 7)) * 100, 100);
                    pregnancyProgress.style.width = `${progressPercent > 0 ? progressPercent : 0}%`;
                    
                    generatePregnancyCalendar(pregnancyStartDate, dueDate, currentWeek, calendarElement);
                }
            }
            
            function initReverseCalculation() {
                // Reverse calculation elements
                const reverseCalculateBtn = document.getElementById('reverse-calculate-btn');
                const targetDateInput = document.getElementById('target-date');
                const pregnancyMonthSelect = document.getElementById('pregnancy-month');
                const pregnancyWeekInput = document.getElementById('pregnancy-week');
                const weekDaySelect = document.getElementById('week-day');
                
                const reversePregnancyStartDateElement = document.getElementById('reverse-pregnancy-start-date');
                const reverseDueDateElement = document.getElementById('reverse-due-date');
                const reverseTargetDateElement = document.getElementById('reverse-target-date');
                const reverseInfoElement = document.getElementById('reverse-info');
                const reverseMonthInfoElement = document.getElementById('reverse-month-info');
                const reverseProgress = document.getElementById('reverse-pregnancy-progress');
                const reverseCalendarElement = document.getElementById('reverse-pregnancy-calendar');
                
                // Month to week range mapping
                const monthToWeekRange = {
                    1: { min: 1, max: 4 },
                    2: { min: 5, max: 8 },
                    3: { min: 9, max: 13 },
                    4: { min: 14, max: 17 },
                    5: { min: 18, max: 21 },
                    6: { min: 22, max: 26 },
                    7: { min: 27, max: 30 },
                    8: { min: 31, max: 35 },
                    9: { min: 36, max: 40 }
                };
                
                // Update week constraints when month changes
                pregnancyMonthSelect.addEventListener('change', function() {
                    const month = parseInt(this.value);
                    const weekRange = monthToWeekRange[month];
                    
                    pregnancyWeekInput.min = weekRange.min;
                    pregnancyWeekInput.max = weekRange.max;
                    
                    // Adjust week value if out of range
                    if (parseInt(pregnancyWeekInput.value) < weekRange.min) {
                        pregnancyWeekInput.value = weekRange.min;
                    } else if (parseInt(pregnancyWeekInput.value) > weekRange.max) {
                        pregnancyWeekInput.value = weekRange.min;
                    }
                });
                
                // Event listener for reverse calculation button
                reverseCalculateBtn.addEventListener('click', calculateReversePregnancy);
                
                function calculateReversePregnancy() {
                    const targetDate = new Date(targetDateInput.value);
                    
                    if (isNaN(targetDate.getTime())) {
                        showReverseError('خطأ في الإدخال', 'الرجاء اختيار تاريخ صحيح من التقويم.');
                        return;
                    }
                    targetDate.setHours(0, 0, 0, 0);
                    
                    const pregnancyMonth = parseInt(pregnancyMonthSelect.value);
                    const pregnancyWeek = parseInt(pregnancyWeekInput.value);
                    const weekDay = parseInt(weekDaySelect.value);
                    
                    // Validate week against month
                    const weekRange = monthToWeekRange[pregnancyMonth];
                    if (pregnancyWeek < weekRange.min || pregnancyWeek > weekRange.max) {
                        showReverseError('خطأ في الإدخال', `الأسبوع ${pregnancyWeek} ليس ضمن الشهر ${pregnancyMonth} (يجب أن يكون بين ${weekRange.min} و ${weekRange.max})`);
                        return;
                    }
                    
                    // Validate inputs
                    if (pregnancyWeek < 1 || pregnancyWeek > 40) {
                        showReverseError('خطأ في الإدخال', 'الأسبوع يجب أن يكون بين 1 و 40');
                        return;
                    }
                    
                    if (weekDay < 1 || weekDay > 7) {
                        showReverseError('خطأ في الإدخال', 'يوم الأسبوع يجب أن يكون بين 1 و 7');
                        return;
                    }
                    
                    // Calculate the start date
                    // Total days = (pregnancyWeek - 1) * 7 + (weekDay - 1)
                    const daysFromStart = (pregnancyWeek - 1) * 7 + (weekDay - 1);
                    const pregnancyStartDate = new Date(targetDate);
                    pregnancyStartDate.setDate(pregnancyStartDate.getDate() - daysFromStart);
                    
                    // Calculate due date (40 weeks from start date)
                    const dueDate = new Date(pregnancyStartDate);
                    dueDate.setDate(dueDate.getDate() + PREGNANCY_WEEKS * 7);
                    
                    // Update UI
                    reversePregnancyStartDateElement.textContent = formatDate(pregnancyStartDate);
                    reverseDueDateElement.textContent = formatDate(dueDate);
                    reverseTargetDateElement.textContent = formatDate(targetDate);
                    
                    const weekDays = ["السبت", "الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة"];
                    reverseInfoElement.textContent = `ستكونين في الأسبوع ${pregnancyWeek} من الحمل، يوم ${weekDay} من الأسبوع`;
                    reverseMonthInfoElement.textContent = `في الشهر ${pregnancyMonth} من الحمل`;
                    
                    const progressPercent = (daysFromStart / (PREGNANCY_WEEKS * 7)) * 100;
                    reverseProgress.style.width = `${progressPercent}%`;
                    
                    // Generate calendar
                    generatePregnancyCalendar(pregnancyStartDate, dueDate, pregnancyWeek, reverseCalendarElement, targetDate);
                }
                
                function showReverseError(title, message) {
                    modalTitle.textContent = title;
                    modalMessage.textContent = message;
                    errorModal.classList.add('show');
                }
            }
            
            function initCalendar() {
                // Initialize month to week range for reverse tab
                const pregnancyMonthSelect = document.getElementById('pregnancy-month');
                if (pregnancyMonthSelect) {
                    pregnancyMonthSelect.dispatchEvent(new Event('change'));
                }
            }
            
            function formatDate(date) {
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
            
            function getMonthName(monthIndex) {
                const months = ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 
                               'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
                return months[monthIndex];
            }

            function getPregnancyMonth(week) {
                if (week <= 4) return 1;
                if (week <= 8) return 2;
                if (week <= 13) return 3;
                if (week <= 17) return 4;
                if (week <= 21) return 5;
                if (week <= 26) return 6;
                if (week <= 30) return 7;
                if (week <= 35) return 8;
                if (week <= 40) return 9;
                return 0;
            }
            
            function generatePregnancyCalendar(startDate, dueDate, currentWeek, calendarElement, targetDate = null) {
                calendarElement.innerHTML = '';
                
                // Calendar headers (starting with Saturday)
                const days = ['سبت', 'أحد', 'اثنين', 'ثلاثاء', 'أربعاء', 'خميس', 'جمعة'];
                days.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-header';
                    header.textContent = day;
                    calendarElement.appendChild(header);
                });
                
                // Calculate the start date for the calendar (previous Saturday)
                const startDayOfWeek = startDate.getDay();
                const daysToSubtract = (startDayOfWeek + 1) % 7;
                const calendarStartDate = new Date(startDate);
                calendarStartDate.setDate(startDate.getDate() - daysToSubtract);
                
                let lastPregnancyMonth = 0;

                for (let i = 0; i < PREGNANCY_WEEKS * 7 + daysToSubtract; i++) {
                    const currentDate = new Date(calendarStartDate);
                    currentDate.setDate(calendarStartDate.getDate() + i);
                    
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    // Highlight important dates
                    if (currentDate.toDateString() === today.toDateString()) {
                        dayElement.classList.add('today');
                    }
                    if (currentDate.toDateString() === startDate.toDateString()) {
                        dayElement.classList.add('pregnancy-start');
                    }
                    if (currentDate.toDateString() === dueDate.toDateString()) {
                        dayElement.classList.add('due-date');
                    }
                    
                    // Highlight target date if provided
                    if (targetDate && currentDate.toDateString() === targetDate.toDateString()) {
                        dayElement.classList.add('current-week');
                    }
                    
                    // Calculate week of pregnancy for this date
                    const daysSinceStart = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
                    const weekOfPregnancy = Math.floor(daysSinceStart / 7) + 1;
                    
                    // Highlight current week
                    if (weekOfPregnancy === currentWeek && daysSinceStart >= 0) {
                        dayElement.classList.add('current-week');
                    }
                    
                    // Day number container
                    const dayNumberContainer = document.createElement('div');
                    dayNumberContainer.className = 'day-number-container';
                    
                    const dayNumberDiv = document.createElement('div');
                    dayNumberDiv.className = 'day-number';
                    dayNumberDiv.textContent = currentDate.getDate();
                    dayNumberContainer.appendChild(dayNumberDiv);
                    
                    // Add week label if first day of week
                    if (daysSinceStart >= 0 && daysSinceStart % 7 === 0) {
                        const weekLabel = document.createElement('div');
                        weekLabel.className = 'week-label';
                        weekLabel.textContent = `الأسبوع ${weekOfPregnancy}`;
                        dayNumberContainer.appendChild(weekLabel);
                    }
                    
                    dayElement.appendChild(dayNumberContainer);
                    
                    // Day info container
                    const dayInfoContainer = document.createElement('div');
                    dayInfoContainer.className = 'day-info-container';
                    
                    // Pregnancy month label
                    if (daysSinceStart >= 0) {
                        const pregnancyMonth = getPregnancyMonth(weekOfPregnancy);
                        if (pregnancyMonth > lastPregnancyMonth) {
                            const monthLabel = document.createElement('div');
                            monthLabel.className = 'pregnancy-month-label';
                            monthLabel.textContent = `الشهر ${pregnancyMonth}`;
                            dayInfoContainer.appendChild(monthLabel);
                            lastPregnancyMonth = pregnancyMonth;
                        }
                    }
                    
                    // Month and year display
                    const monthYear = document.createElement('div');
                    monthYear.className = 'month-year';
                    monthYear.textContent = `${getMonthName(currentDate.getMonth())}`;
                    
                    const yearDisplay = document.createElement('div');
                    yearDisplay.className = 'year-display';
                    yearDisplay.textContent = `${currentDate.getFullYear()}`;
                    
                    dayInfoContainer.appendChild(monthYear);
                    dayInfoContainer.appendChild(yearDisplay);
                    
                    dayElement.appendChild(dayInfoContainer);
                    
                    calendarElement.appendChild(dayElement);
                }
            }
            
            // Initial calculation on page load
            document.getElementById('calculate-btn').click();
        });
    </script>
</body>
</html>
